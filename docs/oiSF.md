# .oiSF (SceneFormat)

Is a file format created for storing how nodes and their data are stored. The node system specified in this file is just an intermediate; since the renderer will require a different kind of data.

This file format will be the node structure of a .fbx or .glTF file. It's similar to a glTF file, as it stores resources alongside 

## Format

```cpp
struct SFHeader {
  
    char header[4];		//oiNS
    
    u16 version;
    u16 flags;
    
    u32 nodes;
    
    u32 objects;
    
    u32 resources;
    
    u32 bufferSize;
    
};

enum class SFNodeType {
  
    //Physical nodes
    
    //Objects
    EMPTY = 0,
    MESH = 1,
    SKELETON = 2,
    BONE = 3,
    SPLINE = 4,
    BILLBOARD = 5,
    EMITTER = 6,
    SKYBOX = 7,
    LINE = 8,
    CAMERA = 9,
    SPEAKER = 10,
    SPRITE = 11,
    
    //Lights
    POINT_LIGHT = 12,
    DIRECTIONAL_LIGHT = 13,
    SPOT_LIGHT = 14,
    SUN = 15,
    AREA_LIGHT = 16,
	CUBE_LIGHT = 17,
    
    //Resource nodes
    
    //Resources (files)
    TEXTURE = 18,
    MODEL = 19,
    SOUND = 20,
    VIDEO = 22,
    
    //Resources (binary blob)
    FRUSTUM = 23,
    MATERIAL = 24,
    VIEW = 25,
    VIEWPORT = 26,
    AABB = 27
    
};

enum class SFNodeFlag {
  
    NONE = 0,
    RESERVED = 0xFF
    
};

struct SFNode {
  
    u32 parent;
    
    u8 type;
    u8 flags;
    u16 name;
    
    u32 localId;
    
    u32 primitiveId;
    
};

//Only present if the node is physical
//(nodeType < TEXTURE)
struct SFObject {
  
    i16 rotation[4];	//Quat in range [-32768, 32767]
    
    u32 resourceId;		//u32_MAX if not supported
    
    f32 pos[3];			//Position
    
    f32 scale[3];		//Scale
    
};

//Only present if the node is resource
//(nodeType >= TEXTURE)
struct SFResource {
    
    u16 name;
    u16 format;
    
    u32 size;
    
};

//SceneFormat
struct SFFile {
  
    SFHeader header;
    
    std::vector<SFNode> nodes;
    
    std::vector<SFObject> objectNodes;
    
    std::vector<SFResource> resources;
    
    Buffer resourceBuffer;
    
    SLFile names;
    
};
```

If size of a SFResource is u32_MAX, the resource isn't included in the file. This can be because it is stored in the file system. If "name.format" is an existing file it will attempt to read that instead. If you name a texture "res/textures/test" with format "png", it will read "res/textures/test.png". 

If your resource is included, it doesn't mean it's like a file, it can also just be binary data. For example, an AABB is a resource, but that's 2 Vec3s for min/max bounds; so 24 bytes. These resources don't have a format (empty string).

Every resource has a size, these resources are tightly packed, so the next resource's data starts after it. "size" can be 0, if they have to be read from a file like mentioned before.

If SFObject::resourceId is u32_MAX, it means that the resource doesn't exist (isn't used) or it is external; like it has to be generated by code. An example of this is a scene featuring procedural geometry, the Mesh node would use an invalid resourceId and the code updates the node later.